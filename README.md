# 去雾算法实现

## 1.DCP
- 算法步骤：
  - 读取原图src，根据原图的小值通道值得到灰度图gray，getGrayByMin
  - 根据灰度图gray及暗通道窗口window，获取暗通道图dc，getDarkChannel，myMinfilter
  - 根据暗通道图和原图，及参数ratio最大百分比，估计大气光值A。getAirLightDcp
  - 根据原图src，投射率图T，大气光值A，去雾。伽马校正未实现！
- 问题：
  - 求暗通道dc的时候最小值滤波算法的合理性，纵横分别求取与依次窗口求取等价性？代码实现问题，考虑！合理性和速度！
  - 求取dc的时候，最小值滤波，对边界会有一个窗口轮廓没有很好的滤波，会导致还原后的图像四周边缘存在问题。
  - 估计大气光值A的时候采用的是暗通道图和原图，原图是三通道的，如何衡量哪个点最亮？根据最大通道值？这里可能存在问题
  - 求取投射图T得时候，大气光值A是三通道得，而T是单通道得，那么A值如何取？取均值！
  - 求T的时候，t得值会不会小于0，需要添加处理？t的下限T0的取值的确定？论文直接取0.1？
- 结论或实验现象：
  - 以house图为例，去雾后的图，dark图基本全黑，很暗，但含雾的原图，在有雾的地方亮度值很高！
  - 以house图为例，去雾后的图，光晕现象严重，窗口为3，粗糙T。
  - 算法时间太长（700ms），大部分都是restore（500）函数和getDarkChannel（100）函数耗时
    纠错：这里是因为调试模式的问题，在debug模式下耗时非常长，在release下，20ms内完成。
  - 通过投射图T观察发现，去雾后的图光晕现象是因为投射图不够精细，物体的边界都是模糊的，在去雾的时候物体边界也就模糊了
  - 去雾后的图亮度偏低，需要后续处理。
- 附加实验：
  - 实验1：直接采用灰度图作为暗通道图去雾。
    理由：暗通道图实际是灰度图最小值滤波得来的，在极端调节滤波半径为0时会怎样？
	效果：获得的T图精细很多，边界清晰，去雾的结果也没有明显光晕，但效果力度不够
	改进：考虑对比度增强（边缘锐化），去雾后再伽马校正，或直方图均衡化。
  - 实验2：直接用灰度图的反色图作为传输图T，再通过T求A
    效果：错误。
- 心得：
  - 不要受已有的结论影响，大胆想象。暗通道提供的不是固定的方法，而是一个普遍的现象。
    具体怎么运用这个现象，可以考虑不同的方法，而不拘泥于他人的理解。

**未完成**
- softmating
- guidefilter